{"componentChunkName":"component---src-templates-blog-post-js","path":"/2023/03/28/fantomas-six-legendary-formatter/","result":{"data":{"site":{"siteMetadata":{"title":"blog.nojaf.com","author":"Florian Verdonck"}},"markdownRemark":{"id":"92474c63-8b45-5eb7-b592-339f53f39d5c","excerpt":"Introduction Early this year we announced our plans for Fantomas 6. We are happy to announce that we have wrapped up the development of version 6 and a preview…","html":"<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>Early this year we announced our plans for <a href=\"https://github.com/fsprojects/fantomas/issues/2709\">Fantomas 6</a>.<br>\nWe are happy to announce that we have wrapped up the development of version 6 and a preview is now available on <a href=\"https://www.nuget.org/packages/fantomas/6.0.0-alpha-008\">NuGet</a>.</p>\n<h3 id=\"whats-new\" style=\"position:relative;\"><a href=\"#whats-new\" aria-label=\"whats new permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What’s new?</h3>\n<p>Fantomas 6 is a major release and contains a lot of new features and improvements. In this post we will highlight some of the most important changes.</p>\n<h2 id=\"parallel-formatting\" style=\"position:relative;\"><a href=\"#parallel-formatting\" aria-label=\"parallel formatting permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Parallel formatting</h2>\n<p>Fantomas 6 is now able to format multiple files in parallel. This is a huge improvement for large projects.<br>\nThis happens out of the box and you don’t have to do anything to benefit from this.</p>\n<h2 id=\"a-whole-lot-of-stroustrup\" style=\"position:relative;\"><a href=\"#a-whole-lot-of-stroustrup\" aria-label=\"a whole lot of stroustrup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A whole lot of Stroustrup</h2>\n<p>In recent months, the <a href=\"https://en.wikipedia.org/wiki/Indentation_style#Variant:_Stroustrup\">Stroustrup style</a> has been officially enlisted in the <a href=\"https://github.com/dotnet/docs/pull/33171\">FSharp style guide</a>.\nThis means we want to support this style in Fantomas as a first class citizen.</p>\n<div class=\"gatsby-highlight\" data-language=\"fsharp\"><pre class=\"language-fsharp\"><code class=\"language-fsharp\"><span class=\"token keyword\">let</span> band <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    Vocals <span class=\"token operator\">=</span> <span class=\"token string\">\"John\"</span>\n    Bass <span class=\"token operator\">=</span> <span class=\"token string\">\"Paul\"</span>\n    Guitar <span class=\"token operator\">=</span> <span class=\"token string\">\"George\"</span>\n    Drums <span class=\"token operator\">=</span> <span class=\"token string\">\"Ringo\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> songs <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"Come Together\"</span>\n    <span class=\"token string\">\"Hey Jude\"</span>\n    <span class=\"token string\">\"Yesterday\"</span>\n    <span class=\"token string\">\"Yellow Submarine\"</span>\n    <span class=\"token string\">\"Here Comes the Sun\"</span>\n<span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">Record</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    ReleaseDate <span class=\"token punctuation\">:</span> <span class=\"token class-name\">DateTime</span>\n    Title <span class=\"token punctuation\">:</span> <span class=\"token class-name\">string</span>\n    Artist <span class=\"token punctuation\">:</span> <span class=\"token class-name\">string</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Enable this style by setting</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">fsharp_multiline_bracket_style = stroustrup</code></pre></div>\n<p>in your <code class=\"language-text\">.editorconfig</code> file.</p>\n<h4 id=\"computation-expressions\" style=\"position:relative;\"><a href=\"#computation-expressions\" aria-label=\"computation expressions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Computation expressions</h4>\n<p>Computation expressions are an interesting topic, on the one hand they are respecting <code class=\"language-text\">Stroustrup</code> style by themselves.\nAnd on the other hand, they could also be formatted as <code class=\"language-text\">Stroustrup</code> in combination with a let binding.</p>\n<div class=\"gatsby-highlight\" data-language=\"fsharp\"><pre class=\"language-fsharp\"><code class=\"language-fsharp\"><span class=\"token keyword\">let</span> something <span class=\"token operator\">=</span>\n    <span class=\"token computation-expression keyword\">task</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let!</span> thing <span class=\"token operator\">=</span> otherThing <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token number\">5</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// versus</span>\n\n<span class=\"token keyword\">let</span> something <span class=\"token operator\">=</span> <span class=\"token computation-expression keyword\">task</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let!</span> thing <span class=\"token operator\">=</span> otherThing <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">5</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As we are a bit split on this topic, we decided to make this configurable.\nBy default, we will format computation expressions on the next line in a binding.\nAnd you can enable control this behavior by setting</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">fsharp_newline_before_multiline_computation_expression = true</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"fsharp\"><pre class=\"language-fsharp\"><code class=\"language-fsharp\"><span class=\"token comment\">// Default: fsharp_newline_before_multiline_computation_expression = true</span>\n<span class=\"token keyword\">let</span> something <span class=\"token operator\">=</span>\n    <span class=\"token computation-expression keyword\">task</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let!</span> thing <span class=\"token operator\">=</span> otherThing <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token number\">5</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// versus</span>\n\n<span class=\"token comment\">// fsharp_newline_before_multiline_computation_expression = false</span>\n<span class=\"token keyword\">let</span> something <span class=\"token operator\">=</span> <span class=\"token computation-expression keyword\">task</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let!</span> thing <span class=\"token operator\">=</span> otherThing <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">5</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"cursor-api\" style=\"position:relative;\"><a href=\"#cursor-api\" aria-label=\"cursor api permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cursor API</h2>\n<p>When you are in the heat of writing code, you don’t want to be bothered by formatting things manually.\nLuckily, Fantomas can help you out with this. By formatting consistently, your raw code can jump around quite a bit.\nAnd one side effect of that, is that your cursor will jump around as well.</p>\n<p>In v6 we have added a new API for editors to be able to know where the cursor should be after formatting.\nJetBrains Rider is the first editor to <a href=\"https://github.com/JetBrains/resharper-fsharp/pull/484\">support this API</a>, and I suspect other editors will follow accordingly.\nThis should improve the overall experience of using Fantomas in your editor.</p>\n<h2 id=\"code-generation\" style=\"position:relative;\"><a href=\"#code-generation\" aria-label=\"code generation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Code generation</h2>\n<p>Fantomas can be used to <a href=\"https://fsprojects.github.io/fantomas/docs/end-users/GeneratingCode.html\">generate F# code</a>. This feature has been around for quite some time, but it was a bit tricky to use.\nTricky, as in, you had to know how your way around the <a href=\"https://fsprojects.github.io/fantomas/reference/fsharp-compiler-syntax.html\">untyped AST</a> to generate the code.\nThe AST from the F# parser has historically always been a bit challenging to work with in Fantomas. Our use-case is slightly different than the compiler’s and the tree we get is not always the most convenient to work with.</p>\n<p>We addressed this trial by inducing our own syntax tree in <a href=\"../../../../2022/12/22/the-oak-sleeps-in-the-acorn/#project-dallas\">“Project Dallas”</a>. In v6, we made those types public and added an API to generate code from them.\nThe result is that you can now generate code in a much more convenient way.</p>\n<p>The old API:</p>\n<div class=\"gatsby-highlight\" data-language=\"fsharp\"><pre class=\"language-fsharp\"><code class=\"language-fsharp\"><span class=\"token preprocessor property\">#r </span><span class=\"token string\">\"nuget: Fantomas.Core, 6.0-alpha-*\"</span>\n\n<span class=\"token keyword\">open</span> FSharp<span class=\"token punctuation\">.</span>Compiler<span class=\"token punctuation\">.</span>Text\n<span class=\"token keyword\">open</span> FSharp<span class=\"token punctuation\">.</span>Compiler<span class=\"token punctuation\">.</span>Xml\n<span class=\"token keyword\">open</span> FSharp<span class=\"token punctuation\">.</span>Compiler<span class=\"token punctuation\">.</span>Syntax\n<span class=\"token keyword\">open</span> FSharp<span class=\"token punctuation\">.</span>Compiler<span class=\"token punctuation\">.</span>SyntaxTrivia\n<span class=\"token keyword\">open</span> Fantomas<span class=\"token punctuation\">.</span>Core\n\n<span class=\"token keyword\">let</span> implementationSyntaxTree <span class=\"token operator\">=</span>\n    ParsedInput<span class=\"token punctuation\">.</span><span class=\"token function\">ImplFile</span><span class=\"token punctuation\">(</span>\n        <span class=\"token function\">ParsedImplFileInput</span><span class=\"token punctuation\">(</span>\n            <span class=\"token string\">\"filename.fsx\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">true</span><span class=\"token punctuation\">,</span>\n            <span class=\"token function\">QualifiedNameOfFile</span><span class=\"token punctuation\">(</span><span class=\"token function\">Ident</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> Range<span class=\"token punctuation\">.</span>Zero<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">[</span> <span class=\"token function\">SynModuleOrNamespace</span><span class=\"token punctuation\">(</span>\n                  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                  <span class=\"token keyword\">false</span><span class=\"token punctuation\">,</span>\n                  SynModuleOrNamespaceKind<span class=\"token punctuation\">.</span>AnonModule<span class=\"token punctuation\">,</span>\n                  <span class=\"token punctuation\">[</span> SynModuleDecl<span class=\"token punctuation\">.</span><span class=\"token function\">Let</span><span class=\"token punctuation\">(</span>\n                        <span class=\"token keyword\">false</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token punctuation\">[</span> <span class=\"token function\">SynBinding</span><span class=\"token punctuation\">(</span>\n                              None<span class=\"token punctuation\">,</span>\n                              SynBindingKind<span class=\"token punctuation\">.</span>Normal<span class=\"token punctuation\">,</span>\n                              <span class=\"token keyword\">false</span><span class=\"token punctuation\">,</span>\n                              <span class=\"token keyword\">false</span><span class=\"token punctuation\">,</span>\n                              <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                              PreXmlDoc<span class=\"token punctuation\">.</span>Empty<span class=\"token punctuation\">,</span>\n                              <span class=\"token function\">SynValData</span><span class=\"token punctuation\">(</span>None<span class=\"token punctuation\">,</span> <span class=\"token function\">SynValInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token function\">SynArgInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">false</span><span class=\"token punctuation\">,</span> None<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> None<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                              SynPat<span class=\"token punctuation\">.</span><span class=\"token function\">Named</span><span class=\"token punctuation\">(</span><span class=\"token function\">SynIdent</span><span class=\"token punctuation\">(</span><span class=\"token function\">Ident</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> Range<span class=\"token punctuation\">.</span>Zero<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> None<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">false</span><span class=\"token punctuation\">,</span> None<span class=\"token punctuation\">,</span> Range<span class=\"token punctuation\">.</span>Zero<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                              None<span class=\"token punctuation\">,</span>\n                              SynExpr<span class=\"token punctuation\">.</span><span class=\"token function\">Const</span><span class=\"token punctuation\">(</span>SynConst<span class=\"token punctuation\">.</span><span class=\"token function\">Int32</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> Range<span class=\"token punctuation\">.</span>Zero<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                              Range<span class=\"token punctuation\">.</span>Zero<span class=\"token punctuation\">,</span>\n                              DebugPointAtBinding<span class=\"token punctuation\">.</span>Yes Range<span class=\"token punctuation\">.</span>Zero<span class=\"token punctuation\">,</span>\n                              <span class=\"token punctuation\">{</span> EqualsRange <span class=\"token operator\">=</span> Some Range<span class=\"token punctuation\">.</span>Zero\n                                InlineKeyword <span class=\"token operator\">=</span> None\n                                LeadingKeyword <span class=\"token operator\">=</span> SynLeadingKeyword<span class=\"token punctuation\">.</span>Let Range<span class=\"token punctuation\">.</span>Zero <span class=\"token punctuation\">}</span>\n                          <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                        Range<span class=\"token punctuation\">.</span>Zero\n                    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                  PreXmlDoc<span class=\"token punctuation\">.</span>Empty<span class=\"token punctuation\">,</span>\n                  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                  None<span class=\"token punctuation\">,</span>\n                  Range<span class=\"token punctuation\">.</span>Zero<span class=\"token punctuation\">,</span>\n                  <span class=\"token punctuation\">{</span> LeadingKeyword <span class=\"token operator\">=</span> SynModuleOrNamespaceLeadingKeyword<span class=\"token punctuation\">.</span>None <span class=\"token punctuation\">}</span>\n              <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">(</span><span class=\"token keyword\">false</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">{</span> ConditionalDirectives <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n              CodeComments <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            Set<span class=\"token punctuation\">.</span>empty\n        <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\n\nCodeFormatter<span class=\"token punctuation\">.</span><span class=\"token function\">FormatASTAsync</span><span class=\"token punctuation\">(</span>implementationSyntaxTree<span class=\"token punctuation\">)</span> \n<span class=\"token operator\">|></span> Async<span class=\"token punctuation\">.</span>RunSynchronously \n<span class=\"token operator\">|></span> <span class=\"token keyword\">fun</span> result <span class=\"token operator\">-></span> printfn <span class=\"token string\">\"%s\"</span> result<span class=\"token punctuation\">.</span>Code</code></pre></div>\n<p>The Oak API:</p>\n<div class=\"gatsby-highlight\" data-language=\"fsharp\"><pre class=\"language-fsharp\"><code class=\"language-fsharp\"><span class=\"token preprocessor property\">#r </span><span class=\"token string\">\"nuget: Fantomas.Core, 6.0-alpha-*\"</span>\n\n<span class=\"token keyword\">open</span> FSharp<span class=\"token punctuation\">.</span>Compiler<span class=\"token punctuation\">.</span>Text\n<span class=\"token keyword\">open</span> Fantomas<span class=\"token punctuation\">.</span>Core\n<span class=\"token keyword\">open</span> Fantomas<span class=\"token punctuation\">.</span>Core<span class=\"token punctuation\">.</span>SyntaxOak\n\n<span class=\"token keyword\">let</span> implementationOak <span class=\"token operator\">=</span>\n    <span class=\"token function\">Oak</span><span class=\"token punctuation\">(</span>\n        <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">[</span> <span class=\"token function\">ModuleOrNamespaceNode</span><span class=\"token punctuation\">(</span>\n              None<span class=\"token punctuation\">,</span>\n              <span class=\"token punctuation\">[</span> <span class=\"token function\">BindingNode</span><span class=\"token punctuation\">(</span>\n                    None<span class=\"token punctuation\">,</span>\n                    None<span class=\"token punctuation\">,</span>\n                    <span class=\"token function\">MultipleTextsNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span> <span class=\"token function\">SingleTextNode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"let\"</span><span class=\"token punctuation\">,</span> Range<span class=\"token punctuation\">.</span>Zero<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> Range<span class=\"token punctuation\">.</span>Zero<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token keyword\">false</span><span class=\"token punctuation\">,</span>\n                    None<span class=\"token punctuation\">,</span>\n                    None<span class=\"token punctuation\">,</span>\n                    <span class=\"token function\">Choice1Of2</span><span class=\"token punctuation\">(</span><span class=\"token function\">IdentListNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>IdentifierOrDot<span class=\"token punctuation\">.</span><span class=\"token function\">Ident</span><span class=\"token punctuation\">(</span><span class=\"token function\">SingleTextNode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> Range<span class=\"token punctuation\">.</span>Zero<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> Range<span class=\"token punctuation\">.</span>Zero<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    None<span class=\"token punctuation\">,</span>\n                    <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                    None<span class=\"token punctuation\">,</span>\n                    <span class=\"token function\">SingleTextNode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"=\"</span><span class=\"token punctuation\">,</span> Range<span class=\"token punctuation\">.</span>Zero<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    Expr<span class=\"token punctuation\">.</span><span class=\"token function\">Constant</span><span class=\"token punctuation\">(</span>Constant<span class=\"token punctuation\">.</span><span class=\"token function\">FromText</span><span class=\"token punctuation\">(</span><span class=\"token function\">SingleTextNode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0\"</span><span class=\"token punctuation\">,</span> Range<span class=\"token punctuation\">.</span>Zero<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    Range<span class=\"token punctuation\">.</span>Zero\n                <span class=\"token punctuation\">)</span>\n                <span class=\"token operator\">|></span> ModuleDecl<span class=\"token punctuation\">.</span>TopLevelBinding <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n              Range<span class=\"token punctuation\">.</span>Zero\n          <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        Range<span class=\"token punctuation\">.</span>Zero\n    <span class=\"token punctuation\">)</span>\n\nCodeFormatter<span class=\"token punctuation\">.</span><span class=\"token function\">FormatOakAsync</span><span class=\"token punctuation\">(</span>implementationOak<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|></span> Async<span class=\"token punctuation\">.</span>RunSynchronously\n<span class=\"token operator\">|></span> printfn <span class=\"token string\">\"%s\"</span></code></pre></div>\n<p>Note that we do still support the old API, but we recommend using the new API instead.</p>\n<h3 id=\"fabulousast\" style=\"position:relative;\"><a href=\"#fabulousast\" aria-label=\"fabulousast permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fabulous.AST</h3>\n<p>Even thought the Oak API simplifies generating code, it can still be a bit verbose. Depending on your use-case, you might want to generate code in a more declarative way.\nFor this, a new library called <a href=\"https://github.com/edgarfgp/Fabulous.AST\">Fabulous.AST</a> has been created. It is a library that will provide a nice DSL similar to other <a href=\"https://docs.fabulous.dev/\">Fabulous</a> projects.<br>\nMore on that in the near future.</p>\n<h2 id=\"verbose-output\" style=\"position:relative;\"><a href=\"#verbose-output\" aria-label=\"verbose output permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verbose output</h2>\n<p>Fantomas always made a lot of noise when you ran it. We reported a line about start and finish of each file.\nThis can be useful, but it can also be a bit annoying. In v6, by default, we silenced this output.</p>\n<p>v5:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"> ~<span class=\"token comment\">#@❯  dotnet fantomas src -r</span>\nProcessing src\\fsc\\fscmain<span class=\"token punctuation\">.</span>fs\n<span class=\"token string\">'src\\fsc\\fscmain.fs'</span> was unchanged\nProcessing src\\FSharp<span class=\"token punctuation\">.</span>Build\\CreateFSharpManifestResourceName<span class=\"token punctuation\">.</span>fs\n<span class=\"token string\">'src\\FSharp.Build\\CreateFSharpManifestResourceName.fs'</span> was unchanged\nProcessing src\\FSharp<span class=\"token punctuation\">.</span>Build\\Fsc<span class=\"token punctuation\">.</span>fs\n<span class=\"token string\">'src\\FSharp.Build\\Fsc.fs'</span> was unchanged\nProcessing src\\FSharp<span class=\"token punctuation\">.</span>Build\\FSharpCommandLineBuilder<span class=\"token punctuation\">.</span>fs\n<span class=\"token string\">'src\\FSharp.Build\\FSharpCommandLineBuilder.fs'</span> was unchanged\nProcessing src\\FSharp<span class=\"token punctuation\">.</span>Build\\FSharpEmbedResourceText<span class=\"token punctuation\">.</span>fs\n<span class=\"token string\">'src\\FSharp.Build\\FSharpEmbedResourceText.fs'</span> was unchanged\nProcessing src\\FSharp<span class=\"token punctuation\">.</span>Build\\FSharpEmbedResXSource<span class=\"token punctuation\">.</span>fs\n<span class=\"token string\">'src\\FSharp.Build\\FSharpEmbedResXSource.fs'</span> was unchanged\nProcessing src\\FSharp<span class=\"token punctuation\">.</span>Build\\Fsi<span class=\"token punctuation\">.</span>fs\n<span class=\"token string\">'src\\FSharp.Build\\Fsi.fs'</span> was unchanged\nProcessing src\\FSharp<span class=\"token punctuation\">.</span>Build\\InternalsVisibleTo<span class=\"token punctuation\">.</span>fs\n<span class=\"token string\">'src\\FSharp.Build\\InternalsVisibleTo.fs'</span> was unchanged\nProcessing src\\FSharp<span class=\"token punctuation\">.</span>Build\\MapSourceRoots<span class=\"token punctuation\">.</span>fs\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>v6:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">~<span class=\"token comment\">#@❯  dotnet fantomas src</span>\n  Formatted │ 119 │ Ignored │ 99 │ Unchanged │ 183 │ Errored │ 0</code></pre></div>\n<p>If you want to see the verbose output, you can use the <code class=\"language-text\">--verbose</code> (or <code class=\"language-text\">-v</code>) flag.</p>\n<h2 id=\"miscellaneous\" style=\"position:relative;\"><a href=\"#miscellaneous\" aria-label=\"miscellaneous permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Miscellaneous</h2>\n<h3 id=\"public-api\" style=\"position:relative;\"><a href=\"#public-api\" aria-label=\"public api permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Public API</h3>\n<p>The <code class=\"language-text\">CodeFormatter</code> module represents the public API of <code class=\"language-text\">Fantomas.Core</code>. We tweaked the API a bit to make it more consistent.</p>\n<h3 id=\"deprecations\" style=\"position:relative;\"><a href=\"#deprecations\" aria-label=\"deprecations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Deprecations</h3>\n<ul>\n<li>Settings <code class=\"language-text\">fsharp_multiline_block_brackets_on_same_column</code> and <code class=\"language-text\">fsharp_experimental_stroustrup_style</code> have been deprecated.\nYou can use <code class=\"language-text\">fsharp_multiline_bracket_style</code> instead. Accepting <code class=\"language-text\">cramped</code> (default), <code class=\"language-text\">aligned</code> and <code class=\"language-text\">stroustrup</code>.</li>\n<li><code class=\"language-text\">--recursive</code> is no longer available on the command line. We will process all files in the given directory recursively by default.\nIf you want to excluded any files or directories, you can use a <a href=\"https://fsprojects.github.io/fantomas/docs/end-users/IgnoreFiles.html\">.fantomasignore</a> file.</li>\n</ul>\n<h2 id=\"last-call-for-feedback\" style=\"position:relative;\"><a href=\"#last-call-for-feedback\" aria-label=\"last call for feedback permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Last call for feedback</h2>\n<p>Currently, v6 is still marked as alpha. The reason for this is that we will want to accept any feedback before we release v6 as stable.\nOnce we label it as beta, we will not accept any breaking changes anymore. That is why we are giving the community some more time to test v6 and give us feedback.</p>\n<h2 id=\"acknowledgements\" style=\"position:relative;\"><a href=\"#acknowledgements\" aria-label=\"acknowledgements permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Acknowledgements</h2>\n<p>Fantomas v6 is a remarkable achievement as many people have contributed to it. I believe this might be the first big release where I didn’t contribute the majority of the code.\nWhich is a very healthy sign for the project.</p>\n<p>I would like to thank the following people in particular for their contributions:</p>\n<ul>\n<li><a href=\"https://github.com/sponsors/josh-degraw\">Josh DeGraw</a> for all his effort around the Stroustrup style. Both in the style guide and Fantomas!</li>\n<li><a href=\"https://github.com/sponsors/dawedawe\">David Schaefer</a> for his work on the command line output, many pull request review and various tweaks!</li>\n<li><a href=\"https://github.com/sponsors/TheAngryByrd\">Jimmy Byrd</a> for taking a crack at parallel formatting in the command line tool!</li>\n<li><a href=\"https://github.com/sponsors/edgarfgp\">Edgar Gonzalez</a> for exposing the <code class=\"language-text\">Oak</code> model and dogfooding it.</li>\n<li><a href=\"https://github.com/DedSec256\">Alex Berezhnykh</a> for his collaboration on the Cursor API.</li>\n</ul>\n<div class=\"text-center my-4\">\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 39.189189189189186%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB1klEQVR42mPIigypyUztLCnoKi9sLyuszsk4efzEx4+fXjx6+urFq7v3Hl87c/PUkRN5+TmdLdV9Dblb1i0+eerEy1dvGxqaGApionpK8he211anZqcFBrYW5N25eus/GFzav//s/kM7t+25fvlqRlJ4XVbo/JasKW0te7du//////x5Cxg8zM1KkrImFBZ1pBa3xkVFurndPgPSfPP2fWdz65LM7Bfnd947eSjC1ynczSLK183V1nlKe+e////rq2sYpEXEov38wm3cvbTt4m2cPPUN1y3c9OzGs7ryal4xaQMDs6kVacv728RERAV4+aTEJfTUtQ30jUNDI7XU1RmYmJgYGBi0tNQ7OlqaWlobGhuau3urW9pyCnKCA7yj/H1czY0n1DQmOjvEm5gm2hmJ8LIxMDAwMoIQVLO+ns6CRXOrC7PS/LzaOjqbWloKygrT4qPj3D1UuQUj7N1MFJViHOwLgz2khHgYQLoYGRhgmq0tzadO7LBwDvBNaioqr+mpzIkO9w50dXKVFrXWUmNn52BkZAh2dE+wd+ZhBmkDa4WZoaWplp4crWXqkplVEhMZXpwWn5YUaWlmbCorryYlxcvNL8TBa6ygm+AcIsjLC3Y2SDsAnJCzxXDZMy0AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"The Fantomas crew having some fun during a Discord call\" title=\"The Fantomas crew having some fun during a Discord call\" src=\"/static/3e96737322e23c71c17963c5fdc06ae1/fcda8/fantomas-ginyu-force.png\" srcset=\"/static/3e96737322e23c71c17963c5fdc06ae1/12f09/fantomas-ginyu-force.png 148w,\n/static/3e96737322e23c71c17963c5fdc06ae1/e4a3f/fantomas-ginyu-force.png 295w,\n/static/3e96737322e23c71c17963c5fdc06ae1/fcda8/fantomas-ginyu-force.png 590w,\n/static/3e96737322e23c71c17963c5fdc06ae1/efc66/fantomas-ginyu-force.png 885w,\n/static/3e96737322e23c71c17963c5fdc06ae1/c83ae/fantomas-ginyu-force.png 1180w,\n/static/3e96737322e23c71c17963c5fdc06ae1/bfe41/fantomas-ginyu-force.png 2082w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<small>The Fantomas crew having some fun during a <a href=\"https://discord.gg/D5QXvQrBVa\">Discord</a> call</small>\n</div>\n<p>Happy formatting,</p>\n<p>Florian</p>\n<p>Photo by <a href=\"https://unsplash.com/@parmanand?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Parmanand Jagnandan</a> on <a href=\"https://unsplash.com/photos/3z0fVrHkXOM?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Unsplash</a></p>","frontmatter":{"title":"Fantomas 6: The Legendary Formatter","date":"2023-03-28","path":"2023/03/28/fantomas-six-legendary-formatter/","tags":["open-source","fsharp","fantomas","tooling"],"cover":{"publicURL":"/static/880f657868495c6a82681b2756b72233/blog.nojaf.com-fantomas-six-legendary-formatter.jpg"},"backgroundPosition":"initial"}}},"pageContext":{"slug":"/fantomas-six-legendary-formatter/","previous":{"fields":{"slug":"/my-fsharp-compiler-scripts/"},"frontmatter":{"title":"My F# compiler scripts","path":"2023/02/02/my-fsharp-compiler-scripts/","tags":["open-source","fsharp","tooling"]}},"next":{"fields":{"slug":"/unleashing-parallel-processing-in-your-fsharp-compiler/"},"frontmatter":{"title":"Unleashing Parallel Processing in Your F# Compiler","path":"2023/08/22/unleashing-parallel-processing-in-your-fsharp-compiler/","tags":["open-source","fsharp","tooling"]}}}},"staticQueryHashes":["3128451518","677231581"],"slicesMap":{}}