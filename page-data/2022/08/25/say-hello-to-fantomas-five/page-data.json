{"componentChunkName":"component---src-templates-blog-post-js","path":"/2022/08/25/say-hello-to-fantomas-five/","result":{"data":{"site":{"siteMetadata":{"title":"blog.nojaf.com","author":"Florian Verdonck"}},"markdownRemark":{"id":"edebe9a0-f143-5506-8d41-c957feafe865","excerpt":"Introduction Fantomas 5 is here! The API of v5 is finalized! In this blogpost I will explain how you can migrate to v5 from v4. The latest preview versions are…","html":"<h2>Introduction</h2>\n<p><strong>Fantomas 5</strong> is here! The API of v5 is finalized! In this blogpost I will explain how you can migrate to v5 from v4.</p>\n<p>The latest preview versions are labelled as beta’s, meaning <strong>the API is stable</strong>.<br>\nPlease start using these latest versions, as the final product will be very close to what is out there today.</p>\n<p>Install Fantomas using</p>\n<blockquote>\n<p>dotnet tool install fantomas —prerelease</p>\n</blockquote>\n<h2>What changed?</h2>\n<p>Under the good, we achieve a massive performance boost. I explained this in a <a href=\"/2022/05/24/word-domination-part-one/\">previous blogpost</a>, Fantomas v5 is <strong>twice or more</strong>, as fast as v4. Achieving this required some serious changes and a major version update.</p>\n<blockquote>\n<p>It is twice as fast, maybe even faster</p>\n</blockquote>\n<h3>House keeping</h3>\n<p>I firmly believe in semantic versioning. If a feature is introduced, and part of the public API, you cannot simply remove it the next release.\nThis level of stability is understandably a blessing, but also a curse when we also need to carry the weight of some choice that have not yielded the benefits that were initially anticipated.\nA major release is one of the rare opportunities where we can really question every past decision.</p>\n<h3>Removal</h3>\n<p>There are some settings and features that were completely removed.\nThese settings were very much legacy and not specified anywhere in any of <a href=\"https://fsprojects.github.io/fantomas/docs/end-users/StyleGuide.html\">the F# style guides</a>.</p>\n<p>If you have the following setings in your <code class=\"language-text\">.editorconfig</code>, please remove them, as they no longer have any influence on the working of Fantomas.</p>\n<ul>\n<li>fsharp_semicolon_at_end_of_line</li>\n<li>fsharp_keep_if_then_in_same_line</li>\n<li>fsharp_indent_on_try_with</li>\n</ul>\n<h3>Change</h3>\n<p>We streamlined a few settings for efficiency’s sake. Please read our <a href=\"https://github.com/fsprojects/fantomas/blob/master/CHANGELOG.md\">changelog</a> to get the full scoop, or visit our <a href=\"https://github.com/fsprojects/fantomas/issues/2160\">announcement issue</a>.\nHere are some of the most interesting changes:</p>\n<h4>Fantomas.Core and fantomas</h4>\n<p>The NuGet package <code class=\"language-text\">Fantomas</code> was renamed to <code class=\"language-text\">Fantomas.Core</code>. This was done to free up the name <code class=\"language-text\">fantomas</code>, so it can be used as the name for the command line tool, previously known as <code class=\"language-text\">fantomas-tool</code>.</p>\n<h4>Revisit Elmish</h4>\n<p>Elmish-inspired code is one of those nice-to-have features, but it didn’t make sense to enable this by default. We choose to remove the default Elmish behaviour that came with the default settings and move all things Elmish to the experimental Stroustrup feature.</p>\n<p><code class=\"language-text\">fsharp_disable_elmish_code</code> should be removed from your <code class=\"language-text\">.editorconfig</code>.</p>\n<h4>Single argument web mode</h4>\n<p>We took a step back when it came to Elmish domain- specific languages and tried to come up with something more generalized.\nThe default Elmish behaviour (a function with two lists) and its sibling feature <code class=\"language-text\">fsharp_single_argument_web_mode</code> (a function with a single list) are now one and the same feature.\nThe setting is also a bit more flexible so that, for example, it can become more usable for <a href=\"https://fsprojects.github.io/fantomas-tools/#/fantomas/preview?data=N4KABGBEDGD2AmBTSAuKAbRAXMXEGct8wBeAHQCcyA7CPQgGQEtCwzIBBXAnAcwtgBXAA7swAbUo0IdHm0ixqiboTHAptGRACiAD2GJoWAHSIAjoICG6MAAoATAGp7ASjAAWeU-vsNWgL4afjL0OOyW1LBYABaIFCo4MZY4AGaWTOj4asFaegZGphbWdgDMjiVuAKzyZSW%2BVJoQgQ05CRz4AJ7U0PIxLGD9EWCWnd0J2Q1aEJhYAIRguqTDoz3AYBTYghS0ns3SU3mGJuZWNosOzm7s3vX7TUGTITwAKiMA1r3R-YO47%2BOQYHUjy0M3mtBIYFe%2BDexgAYgIALYAJQIgnQOB8wJkhwKJ2KtHs8moJB8kFae00AF1ggAfAB8CQYlgARogbOx8JYEcJMFkyS0GgB6QVgADK2CwTGovHwKA0wokACpjMAUvgADRq3T%2BalCkVq6KWCjCAD6CLRkvQUsQJuZ6Fg0Detoolkd2HwJsUJs5CJtcHQggRxKwFEEiHl%2BvwhuNJsQ%2BjiTF91Cw1m9IaEhFDpsIHUwJBDYag6vAUHwEqlMtQEhLEFAUygABIsB0DFXIFKsJBi-XIA2AG7WMNV8Q1qYABm79agAElqEhk6KmAAvZCT%2BvuUcQSmj-xrwGbxvN1todvJrsH3sDgPINAjqdgACMe60kAAspZdMwlAxENKYuf7wfewxwPbcAj3Ospl7I8bygX94AAeRSL9EFFZtMAAqD%2B0HWC7ynexnxkSBtDnJCUMwnt0BSSBQJ3CCLybFtYMgZlYFgdAKKI7Dr2HA8IBKQiIEgWcywoLBYSlawADlEAAdytJROK0AtEFo8DR0gl9GOPKBWPYpTGyvIdbz4jxBKgUVhFdRAACFEBSWANgABSNLlsDiAy6FDVT6zAmRdw0hiYLbPSOMIy8cN4%2B9KnMyBLOsuyHI2BhYFkuJoBGRBZz7B1kiYRRPNwby1P8%2Bie205jQoMiKeJM%2B8ADZYvi6BbPsxzEAAVWEAwKAyststyyUCvMtJMh8qY-KaMqsOCk8qvC7jjOre8AHYmqslrEvagBhdARnwbbFEzQQjEcwrRrLEqpsC8rZt0tiwoYozcNMgAOdaErajZX0QBFWQoc7rEu3y6JumamJCh7qsWl77wATg%2BzavsQQ77WoQGxqusAAq0TSuLulioYW56oqnB8J1MuKNsQDgUjwChDoRBFLEKlSsZxmQ8aEirIf04nIrqsmn0p5rWqS1DfqYf1htMi7xq0SbsemrSCfmp6BeWsmCJF6nafp8UESl9iZfvNmQfU3GgohuaifV2rNfrB8BJ16yOAEQQ5wAETZRMmHp1nivN0qwZV62oA7aGScFx33Fi99dGnFJnliahRWiRysAAdSYeB-3MkCg%2Buy3brD09O35%2B28MdmLKfjxPk9-bQxrTjPs9z6JCvqguJtB4vwZ0svI41qupgfRra4-WcUiYXQEJ65JHLyDZ8HwfL0fM17u4V3vOatgeI4rpaR60B81on3QUTgCh4DbvPTPcLeZEVjnaz35iD7to-TIfd7z8vxz4BSUDP9JC048AInwIVB87Nlb41LuadEGRrSwkcszLA9NngQ0PrDMmCNKb-2vq%2BC0SClAoIoGg-2sVoDRldPTE0skc7-hgSHOB%2B8zzYNJvWYCccPxuxdB0BCFBmCEFvh3Dej8tw71fiXNh5dP44K4cLe8b5eEUH4YI4RWAgF-TiKA8BkDzLQMLkrFh3MCYIMtMg1ByQMFYPkZwqY9htbKL4ZYARQiWBYCIYghSiAyEUI8lQmhRg4j0MYR3ZhfdQ6yKHpXUy9hnbKPjgANRwjZKU8AKyiMKpvSJu8ZHv3YfY6OjjY7n1hB7Iwa90lziyeEwqD88nSP7oUuR5Uo4O0cTXJJH5PZRAAOLYCXgQVeihsniKafuApvNHrtOHvE8eSTiG%2BJsvaR0NkXRuiIAhVOblUaBnXqZM2PcLb5JaTM2JX97z2DPsomS8lrR2SwGlX8mCDDe2ntQP2a8OBzh%2BjoigBijmBxOcHKJrDKq2zmXE65v8XFWl4NQCp3QhqpyYIi5IWxEDPFgLOecKZUUY2BqCouZzomQr5sUzpWh7B4PhfTageU%2ByIBStKf5-0PlSm%2BUdIl8sn5SKmecm2lLoVXKnCUCmSzEEoSZH9eAlhdqwFXtKe5vjeWTK5oeUuatRUKKmCUJRU5iLxgoImX8KZ0AAGlECIGEHi81s4NkRGoeq4xL9BXkouRwkpWgSjOKNasiIbwUL4DdkIOcMlCCIHgN4yxShhkrzXkC02ILt6nOaZ64VsysIdOPjIEoiSA1Gi2hsT2LBoCmsNoyvA8AOpfMUN7aAe0XSEpGkDPlkj00eohV6qleb%2BJlOUYcSt5rrBoXdsdYQaFcyrmBWGDVb82wf11Q4313SjXWttfHbRICUiBuoMG60yayZjgkWAZ%2BsCzHaqhTm%2BZ94SiLKNeOqWXiECzvvHLdmJZKSTnbPgWEq8qyfv8EAA\">Expecto tests</a>.</p>\n<p>To enable it, you need to add two settings: the existing <code class=\"language-text\">fsharp_multiline_block_brackets_on_same_column</code> setting, and the new <code class=\"language-text\">fsharp_experimental_stroustrup_style</code> setting.</p>\n<p><code class=\"language-text\">fsharp_single_argument_web_mode</code> should be removed from your <code class=\"language-text\">.editorconfig</code>.</p>\n<p>Why do I need two settings? Well, because Stroustrup is more of an extension of <code class=\"language-text\">fsharp_multiline_block_brackets_on_same_column</code> and it builds upon it.</p>\n<h3>Addition</h3>\n<p>Besides the core development of v5, there are also some community-driven features.</p>\n<h4>Keep max empty lines</h4>\n<p>Fantomas tries to respect the newlines you had in the original source code. The main reason for this is that it is very hard to come up with a good heuristic for when to introduce or remove newlines.</p>\n<div class=\"gatsby-highlight\" data-language=\"fsharp\"><pre class=\"language-fsharp\"><code class=\"language-fsharp\"><span class=\"token keyword\">if</span> foo <span class=\"token keyword\">then</span>\n   a\n\nmyFunction arg1 arg2 </code></pre></div>\n<p>Fantomas will, in this example, restore the newline between <code class=\"language-text\">if/then</code> and the <code class=\"language-text\">myFunction</code> function call.</p>\n<p>However, if there were multiple blank lines between these code blocks, Fantomas would restore each one of them.</p>\n<p>In v5, we’ve added a new setting that allows you to limit the amount of subsequential newlines that are are being restore.\nThis amount can be controlled by <code class=\"language-text\">fsharp_keep_max_number_of_blank_lines</code>.</p>\n<h4>Stroustrup</h4>\n<p>A controversial addition to v5 is the ability to format some code structures according to the <a href=\"https://en.wikipedia.org/wiki/Indentation_style#Variant:_Stroustrup\">Stroustrup style</a>.\nThis style is quite popular in the F# community and there have been requests for it for some time now. More details about the origin of this setting can be found in <a href=\"https://github.com/fsprojects/fantomas/issues/1408\">#1408</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"fsharp\"><pre class=\"language-fsharp\"><code class=\"language-fsharp\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">MyRecord</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    X<span class=\"token punctuation\">:</span> <span class=\"token class-name\">int</span>\n    Y<span class=\"token punctuation\">:</span> <span class=\"token class-name\">int</span>\n    Z<span class=\"token punctuation\">:</span> <span class=\"token class-name\">string</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> myRecordInstance <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    X <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    Y <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\n    Z <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>   \n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> myAsyncFunction a b c <span class=\"token operator\">=</span> <span class=\"token computation-expression keyword\">async</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let!</span> d <span class=\"token operator\">=</span> otherAsyncFunction a b\n    <span class=\"token keyword\">return</span> d <span class=\"token operator\">+</span> c\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The key problem with this feature request is that it is not a part of any F# style guide. This makes it hard on the maintainers to judge whether this setting is worth the maintenance trouble.\nIt is <strong>quite an impactful change</strong> and <strong>affect a lot of areas of the code base</strong>. Very few people understand this impact when discussing about the code- style of things 😔.</p>\n<p>It also doesn’t help that we already have two existing ways of dealing with this. A third option is excessive.\nEspecially when you consider this is not a paid product and they’re very few active contributors to the project.</p>\n<p>Luckily, a recent issue was raised on the <a href=\"https://github.com/fsharp/fslang-design/issues/706\">F# style guide repository</a>. Please engage in this thread and help us come to a positive solution.</p>\n<p>Because this feature wasn’t discussed or properly debated, everything is still in an early stage. This will surely evolve over time, and time will tell where this is going.</p>\n<h5>The inner workings</h5>\n<p>The way Stroustrup works is that for certain multiline expressions the code is being printed on the current line instead of on the next line. This requires knowledge of the junction of two code constructs.\nInstead of rewriting these exact circumstances entirely, we made a trade-off at the junction, and let the second expression play out like it would when the <code class=\"language-text\">fsharp_multiline_block_brackets_on_same_column</code> is enabled.</p>\n<p>To pull this off, you need to enable <code class=\"language-text\">fsharp_multiline_block_brackets_on_same_column’</code> in order to achieve valid code and the expected result.\n<strong>The technical changes to the code base were very drastic</strong>, so the decision was made to piggy-back on an existing setting. This is the reason why you need to enable both settings.</p>\n<div class=\"gatsby-highlight\" data-language=\"fsharp\"><pre class=\"language-fsharp\"><code class=\"language-fsharp\"><span class=\"token comment\">// fsharp_multiline_block_brackets_on_same_column = true</span>\n<span class=\"token keyword\">let</span> myRecordInstance <span class=\"token operator\">=</span> \n    <span class=\"token punctuation\">{</span>\n        X <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n        Y <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\n        Z <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>   \n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// fsharp_multiline_block_brackets_on_same_column = true</span>\n<span class=\"token comment\">// fsharp_experimental_stroustrup_style = true</span>\n<span class=\"token keyword\">let</span> myRecordInstance <span class=\"token operator\">=</span>  <span class=\"token punctuation\">{</span>\n    X <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    Y <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\n    Z <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>   \n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// The extra setting, will at certain junctions print the code at the current line, leading to the Stroustrup effect.</span></code></pre></div>\n<h2>Thanks to my sponsor, G-Research</h2>\n<p>I am grateful for the <strong>substantial support</strong> I have received from <a href=\"https://www.gresearch.co.uk/\">G-Research</a>.\nIt has allowed me to work on Fantomas for full working-days and really take the project to the next level – from Fantomas V4 to Fantomas V5.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f37d0e770f0849f3ca98c842f6c4c553/a2510/g-research.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIDAf/EABgBAQADAQAAAAAAAAAAAAAAAAABAgQF/9oADAMBAAIQAxAAAAHk1lt5momoAH//xAAbEAABBAMAAAAAAAAAAAAAAAABAAIQESAiQf/aAAgBAQABBQJBwMc2vD//xAAVEQEBAAAAAAAAAAAAAAAAAAABIP/aAAgBAwEBPwECP//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABgQAAIDAAAAAAAAAAAAAAAAAAABECBB/9oACAEBAAY/ApaFlf/EABwQAQACAQUAAAAAAAAAAAAAAAEAESEQIDFBUf/aAAgBAQABPyGIUOiX7CoC6BznG3//2gAMAwEAAgADAAAAEIPvvv/EABURAQEAAAAAAAAAAAAAAAAAAAEg/9oACAEDAQE/EECrH//EABURAQEAAAAAAAAAAAAAAAAAAAEg/9oACAECAQE/EFRj/8QAHRAAAgEEAwAAAAAAAAAAAAAAAREhABAxcSBBUf/aAAgBAQABPxBME+SakyORBR0e7TcntTqeEQlrj//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"G-Research logo\"\n        title=\"G-Research logo\"\n        src=\"/static/f37d0e770f0849f3ca98c842f6c4c553/1c72d/g-research.jpg\"\n        srcset=\"/static/f37d0e770f0849f3ca98c842f6c4c553/a80bd/g-research.jpg 148w,\n/static/f37d0e770f0849f3ca98c842f6c4c553/1c91a/g-research.jpg 295w,\n/static/f37d0e770f0849f3ca98c842f6c4c553/1c72d/g-research.jpg 590w,\n/static/f37d0e770f0849f3ca98c842f6c4c553/a8a14/g-research.jpg 885w,\n/static/f37d0e770f0849f3ca98c842f6c4c553/a2510/g-research.jpg 1000w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Release party 🥳</h2>\n<p>I would like to announce the official launch of Fantomas V5:\nOn September 16th at 6PM (CEST), we will have a grand release feast on our <a href=\"https://discord.gg/rUTUmq3n?event=1010483519073558539\">Discord server</a>.</p>\n<p>Please join us to celebrate!</p>\n<p>Cheers,</p>\n<p>Florian</p>\n<p>Photo by <a href=\"https://unsplash.com/@florianwehde?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Florian Wehde</a> on <a href=\"https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Unsplash</a></p>","frontmatter":{"title":"Say Hello to Fantomas 5","date":"2022-08-25","path":"2022/08/25/say-hello-to-fantomas-five/","tags":["open-source","fsharp","fantomas","tooling"],"cover":{"publicURL":"/static/1e6f5dea683b3e55f0b5a73de73418df/blog.nojaf.com-say-hello-to-fantomas-five.jpg"}}}},"pageContext":{"slug":"/say-hello-to-fantomas-five/","previous":{"fields":{"slug":"/world-domination-part-one/"},"frontmatter":{"title":"World domination, part one","path":"2022/05/24/word-domination-part-one/","tags":["open-source","fsharp","fantomas","tooling"]}},"next":{"fields":{"slug":"/the-oak-sleeps-in-the-acorn/"},"frontmatter":{"title":"The oak sleeps in the acorn","path":"2022/12/22/the-oak-sleeps-in-the-acorn/","tags":["open-source","fsharp","fantomas","tooling"]}}}},"staticQueryHashes":["3128451518","677231581"],"slicesMap":{}}