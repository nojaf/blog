{"componentChunkName":"component---src-templates-blog-post-js","path":"/2022/03/05/a-word-on-triple-slash-comments/","result":{"data":{"site":{"siteMetadata":{"title":"blog.nojaf.com","author":"Florian Verdonck"}},"markdownRemark":{"id":"1e046df8-7450-587d-883e-e08b2f53404f","excerpt":"Intro Yesterday, pretty much out of nowhere, FCS 41.0.3 was published on NuGet.\nI must say, I’m pretty hyped about this release. It contains a few PRs that…","html":"<h2>Intro</h2>\n<p>Yesterday, pretty much out of nowhere, <a href=\"https://www.nuget.org/packages/FSharp.Compiler.Service/41.0.3\">FCS 41.0.3</a> was published on NuGet.\nI must say, I’m pretty hyped about this release. It contains a few <a href=\"https://github.com/dotnet/fsharp/pulls?q=is%3Apr+is%3Aclosed+author%3Anojaf+merged%3A2021-10-30..2022-03-03\">PRs</a> that improve the syntax tree and provide more information to work within Fantomas.</p>\n<p>It also contains some <a href=\"https://github.com/dotnet/fsharp/pulls?q=is%3Apr+11973+12484+12783\">XML documentation improvements</a> that Alex of the Rider team has been working on.\nYou can read the details about this new XML collecting mechanism in this <a href=\"https://github.com/fsharp/fslang-design/blob/main/tooling/FST-1035-xml-documentation-collecting-mechanism.md\">RFC</a>. It is a nice improvement and I’ve decided to implement an <a href=\"https://github.com/fsprojects/fantomas/issues/1878\">enhancement in Fantomas</a> due to these changes.</p>\n<h2>There actually are comments in the syntax tree</h2>\n<p>In the past, I had the luxury of <a href=\"/public-speaking\">speaking about Fantomas</a> at conferences. In a lot of these talks, I explain how Fantomas works and rant a bit <a href=\"https://youtu.be/R9Ob5Vp4a9c?t=1580\">about code comments not being a part of the syntax tree</a>. Now that isn’t exactly true. You see, at some very specific locations, triple-slash comments are preserved in the untyped syntax tree as <a href=\"https://fsharp.github.io/fsharp-compiler-docs/reference/fsharp-compiler-xml-prexmldoc.html\">PreXmlDoc</a>.</p>\n<p>We used to ignore this information in Fantomas, and capture those comments the same way we capture other types of comments. Which at the time seemed like the right thing to do.\nNow that the collection mechanism changed at the compiler side, we can start trusting those comments.</p>\n<h2>One less trivia</h2>\n<p>The more information we have in the untyped syntax tree, the better. So, we decide in <a href=\"https://github.com/fsprojects/fantomas/releases/tag/v4.7.0\">Fantomas 4.7</a> to not accept triple-slash code comments as trivia comments anymore.\nThis can lead to some <a href=\"https://github.com/fsprojects/fantomas/issues/2126\">unexpected situations</a>. Triple slash comments are only collected by the F# parser at very specific locations.</p>\n<p>One example is <a href=\"https://fsharp.github.io/fsharp-compiler-docs/reference/fsharp-compiler-syntax-synbinding.html\">SynBinding</a>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d776f53fe59c651c2abf345449ae6f57/24c4a/synbinding-prexmldoc.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.848484848484844%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAB2HAAAdhwGP5fFlAAABO0lEQVQoz4WQS07DMBCGc3dWXAABS67BDViwYQUCiZI2CSRp7PFz/Aq/i2ABqLVGkRPl+x/TCCEWsRhrOcYQU4jRczgMc6h3x+w8Ow7WuGmcL69ubi+u+fzs4e6+Yc8f09iN7bh/F2K/yH3KkGBJShknjffQq6LFMdSjxlelCxEkm1xyCHCtxqE+eV0zs5ckPfuh2w3DJKTURjkPe19KWb9PU0pa/xwIKUXQ1UoNm0HOs/ecM8C8ruVnml/vh6mwlDLEkHPqX57bp0frIpF2znpnkesELKSoZWOw1nTdjqQwJhCRrBeNpgCPwHCOKQWtVd93aKG1q6TFDh1++Op8BAYeEHKeJ1gqTcZ4JMfuU44nY1eYFE3TuNm8ttu3dtt2Qz+LGf4HOKd/YdTDtmGjdLVCVJRHCrStE2vnT+LnQlKlNTTVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"SynBinding snippet\"\n        title=\"SynBinding snippet\"\n        src=\"/static/d776f53fe59c651c2abf345449ae6f57/799d3/synbinding-prexmldoc.png\"\n        srcset=\"/static/d776f53fe59c651c2abf345449ae6f57/00d96/synbinding-prexmldoc.png 148w,\n/static/d776f53fe59c651c2abf345449ae6f57/0b23c/synbinding-prexmldoc.png 295w,\n/static/d776f53fe59c651c2abf345449ae6f57/799d3/synbinding-prexmldoc.png 590w,\n/static/d776f53fe59c651c2abf345449ae6f57/2a3d6/synbinding-prexmldoc.png 885w,\n/static/d776f53fe59c651c2abf345449ae6f57/ae92f/synbinding-prexmldoc.png 1180w,\n/static/d776f53fe59c651c2abf345449ae6f57/24c4a/synbinding-prexmldoc.png 2640w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>In essence, every data type in <a href=\"https://github.com/dotnet/fsharp/blob/main/src/fsharp/SyntaxTree.fsi\">SyntaxTree.fsi</a>, that has a <code class=\"language-text\">PreXmlDoc</code> node can contain a triple-slash comment.</p>\n<h2>Awareness</h2>\n<p>This change in Fantomas 4.7 can be a bit impactful. I admit I got a bit carried away by the unexpected FCS release. I don’t regret this change and I believe it will educate end-users that there is a subtle difference between <code class=\"language-text\">///</code> and <code class=\"language-text\">//</code> in FSharp code. But yes, depending on how you were using this, you might need to add a new entry in your <a href=\"https://github.com/fsprojects/fantomas/blob/master/docs/Documentation.md#updating-to-a-new-fantomas-version\">.git-blame-ignore-revs file</a>.</p>\n<p>Cheers,</p>\n<p>Florian</p>\n<p><span>Photo by <a href=\"https://unsplash.com/@fahrulazmi?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Fahrul Azmi</a> on <a href=\"https://unsplash.com/s/photos/three?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Unsplash</a></span>\n</p>","frontmatter":{"title":"A word on triple slash comments","date":"2022-03-05","path":"2022/03/05/a-word-on-triple-slash-comments/","tags":["open-source","fsharp","fantomas","tooling"],"cover":{"publicURL":"/static/blog.nojaf.com-triple-slash-comments-44cb062ac20b55cf4fae5258c46202fc.jpg"}}}},"pageContext":{"slug":"/a-word-on-triple-slash-comments/","previous":{"fields":{"slug":"/fs-advent-2021-fantomas-daemon/"},"frontmatter":{"title":"Fantomas Daemon","path":"2021/12/07/fs-advent-2021-fantomas-daemon/","tags":["open-source","fsharp","fantomas","tooling"]}},"next":null}}}